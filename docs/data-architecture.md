# CourseHub Data Architecture

**Decision Date:** 2026-02-05
**Status:** Approved
**Applies To:** All CourseHub data layer logic, requirement validation, and semester update workflows

---

## 1. Overview

CourseHub uses a **two-file data architecture** to separate scheduling data from requirement validation data. This separation ensures that semester-to-semester catalog updates do not break requirement validation logic, and that requirement changes do not require catalog regeneration.

### Data Files

| File | Purpose | Update Frequency | Source of Truth |
|------|---------|-----------------|-----------------|
| `scripts/cleaned_courses.json` (+ `.csv`) | **Course Catalog** — scheduling, instructors, ratings, descriptions, meeting times | Every semester | Wharton course offerings reports |
| `data/course_registry.json` | **Course Registry** — lightweight lookup for requirement validation | Rarely (when requirements change) | Major/core requirements files + catalog |
| `Student Requirements/wharton_mba_core_requirements.json` | Core curriculum rules and course lists | Annually (when curriculum changes) | Wharton MBA Core Curriculum Guide |
| `Student Requirements/wharton_mba_major_requirements.json` | Major requirements, pillars, elective lists | Annually (when majors change) | Wharton MBA Major Requirements docs |

---

## 2. Design Decision: Why Two Files (Option B)

### Problem

The major requirements files reference 311 unique course IDs. The course catalog (generated from Wharton's semester reports) contains only 252 courses. This leaves 124 course IDs that are valid for requirement fulfillment but have no catalog entry:

- **~94 Wharton courses** not offered in the current academic year (e.g., MGMT7110, STAT7010, BEPP7040)
- **~30 non-Wharton Penn courses** from other schools (CIS, EAS, EDUC, LAW, etc.)

### Options Considered

| Option | Approach | Rejected Because |
|--------|----------|-----------------|
| A. Single Enriched Catalog | Add all missing courses to `cleaned_courses.json` with status flags | Catalog becomes a merge of two concerns; semester regeneration risks overwriting manually-added entries |
| **B. Separate Registry** | **Keep catalog clean; create lightweight registry for validation** | **Selected** |
| C. Requirements-Only | Treat requirements files as self-sufficient; no registry | Students see bare course IDs with no titles for ~94 courses; poor UX |

### Why Option B

- **Catalog stays clean** — regenerated from Wharton CSVs each semester with no manual entries to protect
- **Registry is stable** — courses rarely get added/removed from major requirements, so the registry doesn't churn
- **Non-Wharton courses fit naturally** — flagged in the registry without polluting the scheduling catalog
- **Semester updates are isolated** — regenerate catalog from new CSVs, then run a reconciliation script to update `currently_offered` flags in the registry
- **Clear query rules** — app logic always knows which file to use (see Section 4)

---

## 3. File Specifications

### 3.1 Course Catalog (`scripts/cleaned_courses.json`)

Generated by `scripts/cleanse_course_data.py` from raw Wharton semester CSVs. Contains only courses actively offered in the current academic year.

**Fields per record:**

```
Course_ID           string    "FNCE7500"
Course_Title        string    "Vent Cap & Fnce Innovat"
Department          string    "FNCE"
Credit_Units        float     1.0
Description         string    (full course description)
Prerequisites       string    "FNCE 6110"
Corequisites        string    null
Term_Availability   string    "Fall" | "Spring" | "Both"
Instructors_Fall    string    "Lucian Taylor; David Wessels"
Instructors_Spring  string    "Jonathan Zandberg"
Section_Count_Fall  int       3
Section_Count_Spring int      3
Total_Capacity      int       425
Meeting_Times_Fall  string    (semicolon-delimited)
Meeting_Times_Spring string   (semicolon-delimited)
Locations_Fall      string    (semicolon-delimited)
Locations_Spring    string    (semicolon-delimited)
Average_Rating_Fall float     3.10375
Average_Rating_Spring float   3.10375
Is_Crosslisted      bool      true
Crosslist_With      string    "FNCE7500001"
Canvas_URL          string    (URL or null)
Syllabi_URL         string    (URL or null)
Course_Level        float     5.0
```

**Regeneration:** Run `python scripts/cleanse_course_data.py` after placing updated Fall/Spring CSVs in `Class Data/`. This overwrites both `cleaned_courses.csv` and `cleaned_courses.json`. The CSV is the canonical format; the JSON is derived from it.

### 3.2 Course Registry (`data/course_registry.json`)

Lightweight lookup covering every course ID referenced in any requirements file. Used for requirement validation and display when a course isn't in the active catalog.

**Fields per record:**

```
course_id           string    "MGMT7110"
course_title        string    "Competitive Strategy"
department          string    "MGMT"
credit_units        float     1.0
is_wharton          bool      true
currently_offered   bool      false
catalog_source      string    "catalog" | "manual" | "non_wharton"
```

- `catalog_source: "catalog"` — metadata pulled from `cleaned_courses.json` (currently offered)
- `catalog_source: "manual"` — metadata manually entered for Wharton courses not currently offered
- `catalog_source: "non_wharton"` — non-Wharton Penn courses (CIS, EAS, EDUC, LAW, etc.)

### 3.3 Core Requirements (`Student Requirements/wharton_mba_core_requirements.json`)

Defines 13 core requirements (6 fixed, 7 flexible) totaling 9.5 CU. Key structural details:

- **Fixed cores** list specific course IDs; students must complete one
- **Flexible cores** list course options; students choose to meet the credit requirement
- **Waivable cores** (ACCT, Corp Finance, Macro, Marketing Flex) include `waiver_details` with substitution rules and eligible course prefixes
- **`credits_required`** is the requirement-level credit target, NOT the credit value of each individual course (see Section 5)

### 3.4 Major Requirements (`Student Requirements/wharton_mba_major_requirements.json`)

Defines 21 majors with 4 structural patterns:

| Structure | Logic | Example Majors |
|-----------|-------|----------------|
| `ELECTIVES` | Pick X credits from course list | BEPP, MGMT, STAT, STRA |
| `COMBINED` | Required courses + remaining from electives | ACCT, FNCE, HCMG, ENTR |
| `PILLARS` | Credits distributed across categorized groups with min/max | BEES, ESGB |
| `COMBINED_PILLARS` | Required courses + pillar-based electives | AIFB |

---

## 4. Query Rules for App Logic

| Question the App Needs to Answer | Primary Data Source | Join To |
|----------------------------------|-------------------|---------|
| Does this course satisfy a core/major requirement? | Requirements JSON files | Registry (for display) |
| What courses can I take next semester? | Course Catalog | Requirements (to flag which ones count) |
| What's the title/credits for a course in my requirements? | Registry | Catalog (if offered, for richer data) |
| Show me schedule, instructor, ratings for a course | Course Catalog | (none) |
| How many credits toward my major does this course give? | Registry (`credit_units`) | (none) |
| Is this course offered this year? | Registry (`currently_offered`) | Catalog (for scheduling details) |

**Lookup priority:** When displaying course info, check the catalog first (richer data). If not found, fall back to the registry. If not in either, the course ID is invalid.

---

## 5. Known Credit Unit Nuances

These are NOT data errors. They are structural cases the app logic must handle correctly:

| Requirement | Course(s) | Catalog CU | Requirement CU | Explanation |
|-------------|-----------|-----------|----------------|-------------|
| STAT_CORE | STAT6130 | 1.0 | 0.5 | Core requires 0.5 CU minimum. STAT6130 is 1.0 CU (overfills). STAT6210 (accelerated) is 0.5 CU. |
| FNCE_CORP_FLEX | FNCE6210 | 0.5 | 1.0 | Abbreviated version for non-majors. FNCE6110 (1.0 CU) is the full version. Requirement is 1.0 CU total but FNCE6210 alone satisfies it. |
| FNCE_MACRO_FLEX | FNCE6230 | 0.5 | 1.0 | Same pattern. FNCE6130 (1.0 CU) is full version. FNCE6230 alone satisfies it. |
| OIDD_FLEX | OIDD6110-6620 | 0.5 each | 1.0 | Students take TWO 0.5 CU courses to reach 1.0 CU, OR take OIDD6900 (1.0 CU) alone. |

**Implementation rule:** For requirement validation, check that the student's selected course(s) are in the requirement's course list AND that total credits from those courses meet `credits_required`. Do NOT assume each course's CU equals `credits_required`.

---

## 6. Validation Rules to Implement

From the requirements files, these constraint types need enforcement:

### 6.1 Prohibited Combinations
- Cannot take both FNCE6210 and FNCE6230
- Cannot count both MKTG7700 and MKTG7270 (Marketing major)
- Cannot count both MKTG7380 and MKTG8500 (Marketing major)
- Cannot count both MKTG7520 and MKTG8520 (Business Analytics major)
- Cannot count both MGMT6910 and MGMT6920 (Entrepreneurship major)

### 6.2 Mutual Major Exclusions
- Cannot declare both FNCE and QFNC
- Cannot declare both ESGB and BEES
- Cannot declare both ESGB and SOGO
- Cannot declare MKOP with MKTG or OIDD

### 6.3 Double-Counting Restrictions
- OIDD6130 and OIDD6620 cannot count toward both AIFB major and OIDD flex core
- OIDD6140 and OIDD6620 cannot double-count toward OIDD flex core and ENTR major
- OIDD6900 cannot double-count toward OIDD flex core and LEAD/MGMT major

### 6.4 Major-Specific Core Overrides
- Finance and Quantitative Finance majors MUST take FNCE6110 (not FNCE6210) and FNCE6130 (not FNCE6230)

### 6.5 Letter Grade Requirement
- All core courses and major courses must be taken for a letter grade (no pass/fail)

### 6.6 Independent Study / Global Modular Caps
- Most majors cap ISP/Global Modular at 1.0 CU toward the major

---

## 7. Semester Update Workflow

When new Fall/Spring course data becomes available:

1. **Replace CSVs** — Drop new Wharton course offering CSVs into `Class Data/`
2. **Regenerate catalog** — Run `python scripts/cleanse_course_data.py` to produce updated `cleaned_courses.csv` and `cleaned_courses.json`
3. **Sync JSON from CSV** — If the CSV is edited manually after generation, regenerate JSON:
   ```
   python3 -c "import pandas as pd, json, numpy as np; ..."
   ```
   (see scripts directory for the conversion snippet)
4. **Run reconciliation** — Execute the reconciliation script (to be built) that:
   - Compares all course IDs in requirements files against the new catalog
   - Updates `currently_offered` flags in `data/course_registry.json`
   - Reports any NEW mismatches (courses added to requirements but not in registry)
5. **Review report** — Check for new missing courses and add them to the registry if needed

### When requirements change:

1. Update the relevant requirements JSON file
2. Run reconciliation to detect any new course IDs not in the registry
3. Add new entries to `data/course_registry.json`

---

## 8. Data Integrity Fixes Applied

The following issues were found and fixed during the initial reconciliation (2026-02-05):

| File | Issue | Fix |
|------|-------|-----|
| `wharton_mba_major_requirements.json` | `LGMT8060` in LEAD major electives | Changed to `LGST8060` (typo: wrong department prefix) |
| `wharton_mba_major_requirements.json` | `HCMG899` in HCMG major electives | Changed to `HCMG8990` (truncated course ID) |

---

## 9. Open Items

- [ ] Build `data/course_registry.json` — populate from catalog + manually add ~94 not-offered Wharton courses and ~30 non-Wharton courses
- [ ] Build reconciliation script that automates the catalog-vs-requirements comparison and registry updates
- [ ] Determine how to source metadata (title, credits) for not-currently-offered courses (Wharton course archive, Penn registrar, or manual entry)
